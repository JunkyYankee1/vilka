# Каталог: Фильтры

## Обзор

Система фильтров позволяет пользователям сужать выбор блюд по цене, остроте и вегетарианскому статусу. Фильтры работают совместно с поиском и навигацией по категориям.

## Функциональность

### Доступные фильтры

1. **Цена (minPrice, maxPrice)**
   - Два числовых поля: "От" и "До"
   - Позволяют указать диапазон цен в рублях
   - Валидация: минимальная цена не может быть больше максимальной
   - Пустые значения означают отсутствие ограничения

2. **Острота (spicy)**
   - Три состояния: `any` | `spicy` | `not_spicy`
   - `any` - любая острота (по умолчанию)
   - `spicy` - только острые блюда
   - `not_spicy` - только не острые блюда

3. **Вегетарианское (vegetarian)**
   - Три состояния: `any` | `vegetarian` | `not_vegetarian`
   - `any` - любое блюдо (по умолчанию)
   - `vegetarian` - только вегетарианские блюда
   - `not_vegetarian` - только не вегетарианские блюда

## URL параметры

Фильтры сохраняются в URL query string для возможности поделиться ссылкой с применёнными фильтрами.

### Формат параметров

```
?q=шаурма&minPrice=200&maxPrice=450&spicy=spicy&veg=1
```

### Параметры

- `q` - поисковый запрос (не относится к фильтрам, но сохраняется вместе с ними)
- `minPrice` - минимальная цена (число)
- `maxPrice` - максимальная цена (число)
- `spicy` - фильтр остроты: `spicy` или `not_spicy` (если не указан, используется `any`)
- `veg` - фильтр вегетарианского: `1` для вегетарианского, `0` для не вегетарианского (если не указан, используется `any`)

### Примеры URL

```
# Только цена от 200 до 500 рублей
?minPrice=200&maxPrice=500

# Острые блюда
?spicy=spicy

# Вегетарианские блюда
?veg=1

# Комбинация: поиск "пицца", цена 300-600, острое, вегетарианское
?q=пицца&minPrice=300&maxPrice=600&spicy=spicy&veg=1
```

## Поведение

### Клиентская фильтрация

- Фильтры применяются **клиентски** к уже загруженным данным каталога
- Нет дополнительных запросов к серверу при изменении фильтров
- Фильтрация происходит мгновенно, без задержек

### Интеграция с поиском и категориями

- Фильтры работают **совместно** с поиском и навигацией по категориям
- При выборе категории/подкатегории/позиции фильтры продолжают применяться
- Поиск и фильтры можно использовать одновременно

### Сброс фильтров

- Кнопка "Сбросить фильтры" очищает все фильтры
- Поисковый запрос (`q`) сохраняется при сбросе фильтров
- Активные фильтры отображаются как чипсы, которые можно удалить по одному

## UI/UX

### Расположение

- **Desktop**: фильтры всегда видны в основном контенте, под информационным блоком
- **Mobile**: фильтры в свёрнутом виде, раскрываются по клику на кнопку "Фильтры"
- Активные фильтры отображаются как чипсы под поисковой строкой (desktop и mobile)

### Визуальная обратная связь

- Активные фильтры подсвечиваются цветом бренда
- Ошибки валидации (например, min > max) отображаются красным текстом
- Счётчик активных фильтров показывается на кнопке фильтров (mobile)

## Технические детали

### Определение isSpicy и isVegetarian

Поля `isSpicy` и `isVegetarian` определяются автоматически на основе:
- Тегов блюда (`tags` массив в базе данных)
- Названия блюда
- Состава блюда (`composition`)

**Правила определения:**

- **isSpicy**: `true` если в тегах/названии/составе есть слова: "остр", "spicy", "чили", "перец"
- **isVegetarian**: `true` если в тегах/названии/составе есть слова: "вегет", "vegetarian", "vegan", "растительн"

### Производительность

- Фильтрация выполняется в памяти через `useMemo` для оптимизации
- Нет лишних ре-рендеров при изменении фильтров
- URL обновляется через `replaceState` (без перезагрузки страницы)

## Компоненты

- `CatalogFilters` - основной компонент фильтров
- `ActiveFilterChips` - отображение активных фильтров как чипсов
- `filterOffers` - чистая функция для фильтрации массива предложений
- `filterUtils` - утилиты для работы с URL query string

## Тестирование

Для тестирования фильтров можно использовать следующие URL:

```
# Все фильтры
?minPrice=200&maxPrice=500&spicy=spicy&veg=1

# Только цена
?minPrice=300&maxPrice=600

# Только острота
?spicy=not_spicy

# Только вегетарианское
?veg=1
```

